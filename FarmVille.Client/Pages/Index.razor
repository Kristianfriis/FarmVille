@page "/"
@inject NavigationManager Nav
@inject FarmService FarmService

<LoadingOverlay IsVisible="Loading" />

<div class="main-menu-container">
    <div class="sky-background">
        <div class="clouds"></div>
    </div>

    <div class="title-section">
        <h1 class="game-title">BLAZOR VILLE</h1>
        <div class="title-subtitle">LETS GET FARMING</div>
    </div>

    <div class="menu-actions woody-panel">
        @if(showContinue)
        {
                     <button class="menu-btn primary" @onclick='NavigateToLastFarm'>
            <span class="btn-text">CONTINUE</span>
        </button>
        }

        <button class="menu-btn primary" @onclick='() => Nav.NavigateTo("/dashboard")'>
            <span class="btn-text">PLAY GAME</span>
        </button>
        
        <button class="menu-btn secondary" @onclick="ToggleHowTo">
            <span class="btn-text">HOW TO PLAY</span>
        </button>
        
        <button class="menu-btn secondary" @onclick="ToggleCredits">
            <span class="btn-text">CREDITS</span>
        </button>
    </div>

    <div class="ground-footer"></div>
        @if (showHowTo)
    {
      <div class="modal-overlay" @onclick="ToggleHowTo">
        <div class="woody-panel modal-content" @onclick:stopPropagation="true">
            <div class="modal-header">
                <h2>HOW TO PLAY</h2>
            </div>
            
            <div class="modal-body">
                <div class="guide-item">
                    <span class="guide-icon">🚜</span>
                    <div class="guide-text">
                        <strong>PLOW:</strong> Prepare the wild grass for planting.
                    </div>
                </div>
                <div class="guide-item">
                    <span class="guide-icon">🌱</span>
                    <div class="guide-text">
                        <strong>PLANT:</strong> SOW seeds into your freshly plowed soil.
                    </div>
                </div>
                <div class="guide-item">
                    <span class="guide-icon">🌽</span>
                    <div class="guide-text">
                        <strong>HARVEST:</strong> Collect crops before they wither!
                    </div>
                </div>
                <div class="guide-item">
                    <span class="guide-icon">💰</span>
                    <div class="guide-text">
                        <strong>EARN:</strong> Visit the Barn to sell produce for coins.
                    </div>
                </div>
            </div>

            <button class="menu-btn primary modal-close-btn" @onclick="ToggleHowTo">
                GOT IT!
            </button>
        </div>
    </div>
    }
</div>

@code {
    private bool showContinue = false;
    private bool Loading = false;

    protected override async Task OnInitializedAsync()
    {
        var lastSlot = await FarmService.LoadLastSaveFarm();
        if (lastSlot.HasValue)
        {
            showContinue = true;
        }
    }

    private async Task NavigateToLastFarm()
    {
        Loading = true;
        await Task.Delay(500);
        var lastSlot = await FarmService.LoadLastSaveFarm();
        if (lastSlot.HasValue)
        {
            Nav.NavigateTo($"/farm/{lastSlot.Value}");
            Loading = false;
            return;
        }
        Loading = false;
    }

    private bool showHowTo = false;
    private void ToggleHowTo() => showHowTo = !showHowTo;

    private void ToggleCredits()
    {
        
    }
}